CREATE INDEX fpidx ON pgbfp USING gist (f);
SET rdkit.tanimoto_threshold = 0.7;
SET rdkit.dice_threshold = 0.8;
SET enable_indexscan=off;
SET enable_bitmapscan=off;
SET enable_seqscan=on;
SELECT
    id, tanimoto_sml(layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol), f) AS sml
FROM
	pgbfp
WHERE layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol) % f
ORDER BY sml DESC, id limit 10;
    id    |        sml        
----------+-------------------
 10560368 |               0.9
  4287001 |  0.80365296803653
  1356857 | 0.747967479674797
   902176 | 0.738317757009346
   690546 | 0.730923694779116
  5161158 | 0.720524017467249
 24761377 | 0.720472440944882
  2952787 | 0.715555555555556
 16411727 | 0.712062256809339
    66722 | 0.711382113821138
(10 rows)

SELECT
    id, dice_sml(layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol), f) AS sml
FROM
	pgbfp
WHERE layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol) # f
ORDER BY sml DESC, id;
    id    |        sml        
----------+-------------------
 10560368 | 0.947368421052632
  4287001 | 0.891139240506329
  1356857 | 0.855813953488372
   902176 | 0.849462365591398
   690546 | 0.844547563805104
  5161158 |  0.83756345177665
 24761377 | 0.837528604118993
  2952787 |  0.83419689119171
 16411727 | 0.831818181818182
    66722 | 0.831353919239905
   689878 | 0.830687830687831
 16746587 | 0.830097087378641
  1941952 | 0.829931972789116
  4440220 | 0.829157175398633
  3218145 | 0.826789838337182
 16746409 | 0.818390804597701
  3218102 | 0.817307692307692
  3218091 | 0.816425120772947
  2842448 | 0.811188811188811
   664261 | 0.809195402298851
   661038 | 0.808823529411765
   289688 | 0.808716707021792
 24747640 | 0.807017543859649
  1098906 | 0.806034482758621
 22431219 | 0.805687203791469
  3585388 | 0.805251641137856
  3218139 | 0.804878048780488
 24746888 | 0.804878048780488
 16000816 | 0.804705882352941
  7579125 | 0.804651162790698
 16746461 | 0.804347826086957
  5281628 | 0.802139037433155
  9642965 | 0.801742919389978
  5808003 |               0.8
(34 rows)

SET enable_indexscan=on;
SET enable_bitmapscan=on;
SET enable_seqscan=off;
SELECT
    id, tanimoto_sml(layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol), f) AS sml
FROM
	pgbfp
WHERE layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol) % f
ORDER BY sml DESC, id limit 10;
    id    |        sml        
----------+-------------------
 10560368 |               0.9
  4287001 |  0.80365296803653
  1356857 | 0.747967479674797
   902176 | 0.738317757009346
   690546 | 0.730923694779116
  5161158 | 0.720524017467249
 24761377 | 0.720472440944882
  2952787 | 0.715555555555556
 16411727 | 0.712062256809339
    66722 | 0.711382113821138
(10 rows)

SELECT
    id, dice_sml(layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol), f) AS sml
FROM
	pgbfp
WHERE layered_fp('O=C1CC(OC2=CC=CC=C12)C1=CC=CC=C1'::mol) # f
ORDER BY sml DESC, id limit 10;
    id    |        sml        
----------+-------------------
 10560368 | 0.947368421052632
  4287001 | 0.891139240506329
  1356857 | 0.855813953488372
   902176 | 0.849462365591398
   690546 | 0.844547563805104
  5161158 |  0.83756345177665
 24761377 | 0.837528604118993
  2952787 |  0.83419689119171
 16411727 | 0.831818181818182
    66722 | 0.831353919239905
(10 rows)

SET enable_indexscan=on;
SET enable_bitmapscan=on;
SET enable_seqscan=on;
DROP INDEX fpidx;
